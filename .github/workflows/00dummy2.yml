name: 00dummy
on:
  push:
    branches: [main]
    paths:
      - senarios/test

jobs:
  testjob0:
    name: testjob0
    runs-on: ubuntu-latest
    outputs:
      joboutput: ${{ steps.jobid.outputs.joboutput }}
    steps:
      - name: sss
        id: jobid
        uses: actions/checkout@master
      - run: |
          curl \
          -H "Accept: application/vnd.github.v3+json" https://api.github.com/hirtanak/hpccicd/actions/jobs/42/logs
        env:
          SSH_SECRET_KEY: ${{ secrets.SSH_SECRET_KEY }}
          SSH_PUBLIC_KEY: ${{ secrets.SSH_PUBLIC_KEY }}      
          
  success:
    name: pbs-success_teams_notification
    runs-on: ubuntu-18.04
    needs: [testjob0]
    steps:
      - uses: actions/checkout@master
      - name: Microsoft Teams Notification
        uses: skitionek/notify-microsoft-teams@master
        if: env.WORKFLOW_CONCLUSION == 'success' # notify only if failure
        with:
          webhook_url: ${{ secrets.MSTEAMS_WEBHOOK }}
          needs: ${{ toJson(needs) }}
          job: ${{ toJson(job) }}
          steps: ${{ toJson(steps) }}
          dry_run: False
      - name: sucuess! 
        run: |
          echo '::success::Previous workflow was sucuess!'

  if_failure:
    name: pbs-failure_teams_notification
    runs-on: ubuntu-18.04
    # 失敗の場合、通知送付
    if: always() # set always
    steps:
      - name: Microsoft Teams Notification
        uses: skitionek/notify-microsoft-teams@master
        if: env.WORKFLOW_CONCLUSION == 'failure' # notify only if failure
        #if: ${{ failure() }}
        with:
          webhook_url: ${{ secrets.MSTEAMS_WEBHOOK }}
          needs: ${{ toJson(needs) }}
          job: ${{ toJson(job) }}
          steps: ${{ toJson(steps) }}        
          dry_run: False
        env: 
          WORKFLOW_CONCLUSION: ${{ env.WORKFLOW_CONCLUSION }}
